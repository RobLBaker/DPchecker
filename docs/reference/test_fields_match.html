<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="test_fields_match() compares the attributes of each dataTable within the EML metadata to the columns in the corresponding .csv. If the columns have the same names and order, the test passes. If the columns differ, the test fails with an error."><title>Test Matching Data/Metadata Fields — test_fields_match • DPchecker</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Test Matching Data/Metadata Fields — test_fields_match"><meta property="og:description" content="test_fields_match() compares the attributes of each dataTable within the EML metadata to the columns in the corresponding .csv. If the columns have the same names and order, the test passes. If the columns differ, the test fails with an error."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DPchecker</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/DPchecker.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Test Matching Data/Metadata Fields</h1>
      
      <div class="d-none name"><code>test_fields_match.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>test_fields_match()</code> compares the attributes of each dataTable within the EML metadata to the columns in the corresponding .csv. If the columns have the same names and order, the test passes. If the columns differ, the test fails with an error.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">test_fields_match</span><span class="op">(</span></span>
<span>  directory <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  metadata <span class="op">=</span> <span class="fu"><a href="load_metadata.html">load_metadata</a></span><span class="op">(</span><span class="va">directory</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>directory</dt>
<dd><p>the directory where the data file(s) are found (i.e. your data package). Defaults to the current working directory. On exit, returns to the current working directory.</p></dd>


<dt>metadata</dt>
<dd><p>The metadata object returned by <code>load_metadata</code>. If parameter not provided, defaults to calling <code>load_metadata</code> in current project directory.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Invisibly returns <code>metadata</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>test_fields_match briefly checks that data files match, but you should really run <code><a href="test_file_name_match.html">test_file_name_match()</a></code> before you run this test.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="DPchecker_example.html">DPchecker_example</a></span><span class="op">(</span><span class="st">"BICY_veg"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Data are provided for example use only. Do not assume that they are complete, accurate, or up to date.</span>
<span class="r-in"><span><span class="fu">test_fields_match</span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Called from: eval(expr, p)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#524: data_tbl &lt;- EML::eml_get(metadata, "dataTable")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#526: if ("attributeList" %in% names(data_tbl)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data_tbl &lt;- list(data_tbl)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#531: metadata_attrs &lt;- lapply(data_tbl, function(tbl) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     arcticdatautils::eml_get_simple(tbl, "attributeName")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#532: metadata_attrs$`@context` &lt;- NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#535: data_files &lt;- list.files(path = directory, pattern = ".csv")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#538: table_names &lt;- NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#539: for (i in 1:length(seq_along(data_files))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tbl_nam &lt;- data_tbl[[i]][["physical"]][["objectName"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     table_names &lt;- append(table_names, tbl_nam)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#540: tbl_nam &lt;- data_tbl[[i]][["physical"]][["objectName"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#541: table_names &lt;- append(table_names, tbl_nam)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#540: tbl_nam &lt;- data_tbl[[i]][["physical"]][["objectName"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#541: table_names &lt;- append(table_names, tbl_nam)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#540: tbl_nam &lt;- data_tbl[[i]][["physical"]][["objectName"]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#541: table_names &lt;- append(table_names, tbl_nam)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#544: names(metadata_attrs) &lt;- table_names</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#547: data_colnames &lt;- sapply(data_files, function(data_file) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     names(readr::read_csv(file.path(directory, data_file), n_max = 1, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         show_col_types = FALSE))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }, USE.NAMES = TRUE, simplify = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#550: if (!(all(names(data_colnames) %in% names(metadata_attrs)) &amp; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     all(names(metadata_attrs) %in% names(data_colnames)))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cli::cli_abort(c(x = "Mismatch in data file column names and the attributes listed in metadata."))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#555: mismatches &lt;- sapply(data_files, function(data_file) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     meta_cols &lt;- metadata_attrs[[data_file]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data_cols &lt;- data_colnames[[data_file]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(meta_cols) == length(data_cols) &amp;&amp; all(meta_cols == </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         data_cols)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(NULL)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else if (all(meta_cols %in% data_cols) &amp;&amp; all(data_cols %in% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         meta_cols)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(c(` ` = paste0("--&gt; {.file ", data_file, "}: Metadata column order does not match data column order")))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         missing_from_meta &lt;- data_cols[!(data_cols %in% meta_cols)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (length(missing_from_meta) &gt; 0) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             missing_from_meta &lt;- paste0("----Missing from metadata: ", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paste0("{.field ", missing_from_meta, "}", collapse = ", "))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             names(missing_from_meta) &lt;- " "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         missing_from_data &lt;- meta_cols[!(meta_cols %in% data_cols)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (length(missing_from_data) &gt; 0) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             missing_from_data &lt;- paste0("----Missing from data file: ", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paste0("{.field ", missing_from_data, "}", collapse = ", "))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             names(missing_from_data) &lt;- " "</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         msg &lt;- c(` ` = paste0("--&gt; {.file ", data_file, "}:"), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             missing_from_meta, missing_from_data)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(msg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }, USE.NAMES = FALSE, simplify = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#579: mismatches &lt;- purrr::discard(mismatches, is.null) %&gt;% unlist()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#583: if (!is.null(mismatches)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cli::cli_abort(c(x = "Column mismatch between data and metadata.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mismatches))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> } else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cli::cli_inform(c(v = "All columns in data match all columns in metadata."))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#586: cli::cli_inform(c(v = "All columns in data match all columns in metadata."))</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> All columns in data match all columns in metadata.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> debug at C:/Users/rlbaker/Documents/RDev/DPchecker_devspace/R/tabular_data_congruence.R#589: return(invisible(metadata))</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Rob Baker, Sarah E. Wright.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

